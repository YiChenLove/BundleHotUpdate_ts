{"version":3,"sources":["assets/Script/HelloWorld.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import BundleManager from \"./bundle/BundleManager\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class SubGame_2 extends cc.Component {\n    @property(cc.Node)\n    moduleLayer: cc.Node = null;\n    @property(cc.Asset)\n    asset1: cc.Asset = null;\n    @property(cc.Asset)\n    asset2: cc.Asset = null;\n\n    _lobbyRootNode: cc.Node = null;\n    _logArr: any;\n    _initHackLog: any;\n\n\n    onDestroy () { \n    }\n\n    onLoad() {  \n        this.hackSysLog()\n        if (!cc.sys.isBrowser) {\n            cc.log(\"[HelloWorld] jsb_writable_:\", jsb.fileUtils.getWritablePath() )\n        }\n\n        let assetPath = \"\";\n        if(typeof(jsb)!=\"undefined\"){\n            let absPath1 = jsb.fileUtils.fullPathForFilename(this.asset1.nativeUrl).replace(\"//\",\"/\")\n            let absPath2 = jsb.fileUtils.fullPathForFilename(this.asset2.nativeUrl).replace(\"//\",\"/\")\n            cc.log(\"absFile_path1:\", absPath1 )\n            cc.log(\"absFile_path2:\", absPath2 )\n            let testLen = absPath1.length>absPath2.length? absPath2.length : absPath1.length \n            for(let i=0;i<testLen;i++){\n                if(absPath1[i] != absPath2[i]){\n                    assetPath = absPath1.substring(0, i)\n                    break\n                }\n            } \n            cc.log(\"absFile_path:\", assetPath )\n        }\n\n        BundleManager.getInstance().initCom({\n            useHotUpdate : true ,     // 是否启用热更新 \n            assetPath: assetPath,\n        }) \n        \n        //-------------------\n\n        // 复制包内模块到可读写路径下,避免首次加载模块时从远程完整拉取\n        BundleManager.getInstance().execUnpackage(()=>{\n\n            BundleManager.getInstance().reqVersionInfo(()=>{ // 获取最新版本\n                this.reloadLobbyRoot()\n            })\n        })\n\n        // 定时检测更新\n        BundleManager.getInstance().reqLoopVersionInfo() \n\n    }\n\n    reloadLobbyRoot(){\n\n        let loadAb = [\"ABLobby\"]\n        // loadAb = [\"ABLobby\", \"ABSubGame1\", \"ABSubGame2\"]\n        BundleManager.getInstance().hotUpdateMultiModule(loadAb,()=>{ // 更新模块到最新版本\n\n            BundleManager.getInstance().addModule(\"ABLobby\", (moduleObj)=>{ // 加载模块\n\n                let abObj = moduleObj.getABObj()\n                \n                abObj.load('root/Scene/LobbyRoot', cc.Prefab, (err, prefab)=>{  // 使用模块资源 \n\n                    cc.log(\"[HelloWorld] load_lobby_prefab_ err:\", JSON.stringify(err) )\n                    if(this._lobbyRootNode){\n                        this._lobbyRootNode.destroy()\n                    }\n                    let lobbyRoot = cc.instantiate(prefab) \n                    this._lobbyRootNode = lobbyRoot\n                    this.moduleLayer.addChild(lobbyRoot, 100)\n                    lobbyRoot.getComponent(\"LobbyRoot\").initModule()    \n                }) \n            })\n        })\n    }\n\n    hackSys_Log_Save(){\n        if(!this._logArr){ return ; };\n\n        let totalLen = this._logArr.length\n        let reportCo = 2000\n        let beginIdx = totalLen-reportCo\n        beginIdx = beginIdx>=0?beginIdx:0\n        let arrTemp = []\n\n        for(let i=beginIdx; i<totalLen; i++){\n            arrTemp.push(this._logArr[i])\n        }\n\n        let retMsg = arrTemp.join(\"\\n\")\n        if(cc.sys.isNative){\n            let path = jsb.fileUtils.getWritablePath()\n            jsb.fileUtils.writeStringToFile(retMsg, path + \"alogRecord.txt\")\n        }\n    }\n\n    hackSysLog(){\n\n        if(this._initHackLog){ return ; } ; this._initHackLog = true ; \n        let _logArr = []\n        this._logArr = _logArr \n        let MAX_STR_LEN = 1300 \n        let excludeStr = { [\"Can't find letter definition in texture\"]:1 } \n        let push_log = function(...arg){  \n            let ignore = false\n            let logStr = arg.join(\" \")\n            let strLen = logStr.length\n            for(let idx = 0;idx<strLen;){\n                let endIdx = idx+MAX_STR_LEN\n\n                let splitStr = logStr.slice(idx, endIdx)\n                for(let excStr in  excludeStr){\n                    if( splitStr.indexOf(excStr, 0) == 0 ){\n                        ignore = true \n                        break \n                    }\n                }\n                if( !ignore ){\n                    _logArr.push(\"_\"+_logArr.length+\"_=> \"+ splitStr +(endIdx<strLen?\"-->\":\"\")) \n                } \n\n                idx = endIdx\n            } \n            return ignore\n        }\n\n        let logDef = function(...arg){ \n            let ignore = push_log(...arg)\n            if(!ignore){\n                cc[\"_sv_log_2_Ori\"].call(cc, ...arg)\n            }\n        }\n        let consoleLogDef = function(...arg){ \n            let ignore = push_log(...arg) \n            if(!ignore){\n                if(cc[\"_sv_console_log_2_Ori\"]) { cc[\"_sv_console_log_2_Ori\"].call(console,...arg ) }\n            } \n        }\n        if(!cc[\"_sv_log_2_Ori\"]){ cc[\"_sv_log_2_Ori\"] = cc.log  }\n        if(!cc[\"_sv_console_log_2_Ori\"]){ cc[\"_sv_console_log_2_Ori\"] = console.log  }\n        cc.log      = logDef\n        console.log = consoleLogDef\n    }\n\n\n}\n"]}